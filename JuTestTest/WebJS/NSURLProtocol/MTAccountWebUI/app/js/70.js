(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{"/TmB":function(t,e){t.exports='<page class="account-switch" :bg-color="true">\n    <title-bar :right-button="titleBarRightButtonText"\n               @right-click="titleBarRightButtonClick">\n    </title-bar>\n    <page-view>\n        <page-title :title="tr(\'title\')"\n                    :description="tr(\'text.message\')"\n                    :padding="true"\n                    :bg-white="true">\n        </page-title>\n\n        <list v-if="fetched">\n            <list-item v-for="(account, index) in accountList"\n                       v-if="!account.delete"\n                       :key="account.user.id"\n                       :avatar="(account.user.avatar + \'!thumb200\') || defaultAvatar"\n                       :title="account.user.screen_name"\n                       :border-bottom-half="true"\n                       :description="getAccountName(index)"\n                       @click="switchAccount(index)"\n                       @avatar-error="avatarImageOnError">\n                <mt-button type="primary"\n                           slot="offside"\n                           width="64"\n                           v-if="editing"\n                           v-text="$tr.text.delete"\n                           @click="deleteAccount(index, $event)"\n                           :class="{disabled : account.selected}" small>\n                </mt-button>\n                <icon font-name="yes" slot="offside" class="selected" v-if="!editing" v-show="account.selected"></icon>\n            </list-item>\n            <list-item class="add-account link"\n                       ficon="add-o"\n                       v-if="showAddCountButton"\n                       :title="tr(\'button.addOrRegister\')"\n                       @click="addAccount">\n            </list-item>\n        </list>\n\n        <footer v-if="fetched">\n            <mt-button border="none"\n                       square="true"\n                       @click="logout"\n                       v-if="showLogoutButton"\n                       v-text="tr(\'button.logout\', \'account\')">\n            </mt-button>\n        </footer>\n    </page-view>\n</page>\n'},fxn9:function(t,e){},p8i9:function(t,e,n){"use strict";e.__esModule=!0;var i=l(n("P2sY")),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n("mrSG"));n("fxn9");var c=n("YKMj"),s=l(n("lqyy")),r=n("rRPG"),u=n("lzrX"),a=n("0jlq"),h=n("Q+em");function l(t){return t&&t.__esModule?t:{default:t}}var d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fetched=!1,e.editing=!1,e.switching=!1,e.titleBarRightButtonText="",e.maxAddSwitchAccounts=8,e.accountList=[],e.defaultAvatar=r.DEFAULT_AVATAR,e}return o.__extends(e,t),Object.defineProperty(e.prototype,"showAddCountButton",{get:function(){return this.accountList.length<this.maxAddSwitchAccounts},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showLogoutButton",{get:function(){return!this._getAppClientConfigs("hide_logout_button")},enumerable:!0,configurable:!0}),e.prototype.created=function(){if(!this._enableAccountSwitch||this.$isWeb)return this.backToAccountPage(),!1;this.titleBarRightButtonClick(),this.fetchAccountList()},e.prototype.backToAccountPage=function(){this.$router.replace(u.ROUTE_ACCOUNT)},e.prototype.titleBarRightButtonClick=function(){var t=this.$tr.text.edit,e=this.titleBarRightButtonText;e===t?(this.editing=!0,e=this.$tr.text.finish):(this.editing=!1,e=t),this.titleBarRightButtonText=e},e.prototype.fetchAccountList=function(){var t=this,e=[],n=this._clientInfo.client_switch_account_list||[],o=function(){n.forEach(function(n,i){t.isCurrent(n)&&(e.push(i),void 0===n.user&&(n.user=t._userInfo||{})),n.selected=t.isCurrent(n),n.delete=!1}),e.length>1&&e.forEach(function(e,i){i>=1&&(n.splice(e,1),t.$accountCommand("UpdateAccountList",{type:"remove",item:e}))}),t.accountList=n,t.fetched=!0};if(n.length<1){var c=(0,i.default)({},this._clientInfo);if(c.user={},n.push(c),!this._hasUserInfo())return this.$toast.showLoading(),this._requestUserInfo().then(function(){c.user=t._userInfo,o(),t.$toast.hide()}).catch(function(){t.backToAccountPage(),t.$toast.hide()}),!1;c.user=this._userInfo}o()},e.prototype.isCurrent=function(t){return this._clientInfo.access_token===t.access_token},e.prototype.getAccountName=function(t){var e=this.accountList[t];return e.user.phone?this._encodePhone(e.user.phone):e.user.email?this._encodeEmail(e.user.email):e.user.assoc_phone?this._encodePhone(e.user.assoc_phone)+" ["+this.tr("titleOfAssocPhone","accountProtect")+"]":this._encodePhone(e.user.id)+" [UID]"},e.prototype.avatarImageOnError=function(t){var e=t.target.src;e=-1!==e.indexOf("!thumb200")?e.replace(/!thumb200/g,""):this.defaultAvatar,t.target.src=e},e.prototype.deleteAccount=function(t,e,n){void 0===n&&(n=!0),e&&e.stopPropagation();try{this.deleteAccountHandle(t,n)}catch(t){this.$toast.show(this.tr("tips.deleteFailure"))}},e.prototype.deleteAccountHandle=function(t,e){void 0===e&&(e=!0);var n=this.accountList[t];if(this.isCurrent(n))return this.$dialog.alert({content:this.tr("tips.deleteCurrentWarning"),buttons:[{type:"primary",text:this.$tr.text.enter}]}),!1;this.$delete(this.accountList,t),this.$accountCommand("UpdateAccountList",{type:"remove",index:t}),e&&this.$toast.success(this.tr("tips.deleteSuccess"))},e.prototype.addAccount=function(){(0,h.openLoginPage)(!0)},e.prototype.reLogin=function(){this.addAccount()},e.prototype.switchAccount=function(t){var e=this,n=this.accountList[t];if(this.editing||n.selected)return!1;this.switching=!0,this.$setAppBackingHandler(function(){e.$accountCommand(e.switching?"BackingStop":"Backing")}),this.$toast.showLoading(this.tr("tips.switching"));var i={headers:{"Access-Token":n.access_token},handleNeedLoginError:!1};this.$api.login.getTokenInfo({},i).then(function(){e.switchAccountRequestSuccess(t)}).catch(function(n){if(e.resetSwitchStatus(),n.failure){if(n.tokenError)return e.openSwitchAccountTokenErrorDialog(t),!1;e.$toast.show(e.tr("tips.switchError"))}else e.$toast.show(e.$tr.text.submitError)})},e.prototype.switchAccountRequestSuccess=function(t){var e=this,n=this.accountList[t];this._setClientInfo({access_token:n.access_token,refresh_token:n.refresh_token,unlogin_token:n.unlogin_token||(0,h.createUnloginToken)(),expires_at:n.expires_at,refresh_expires_at:n.refresh_expires_at}),this.accountList.forEach(function(t,n){e.$set(e.accountList,n,(0,i.default)({},t,{selected:!1}))}),this.accountList.splice(t,1),n.selected=!0,this.$localStorage.set(a.LOCAL_KEY_LASTED_UID,n.user.id||""),this.accountList.unshift(n),this.timer=setTimeout(function(){e._requestUserInfo({with_safety_info:1}).then(),e.$toast.success(e.tr("tips.switchSuccess"),{time:1e3,close:function(){e.$accountCommand("UpdateAccountList",{type:"switch",index:t}),e.switching=!1,e.$removeAppBackingHandler(),clearTimeout(e.timer)}})},500)},e.prototype.openSwitchAccountTokenErrorDialog=function(t){var e=this;this.accountList[t],this.$dialog.confirm({content:this.tr("tips.switchFailure"),buttons:[{type:"primary",text:this.tr("button.relogin"),click:function(){e.deleteAccount(t,null,!1),e.reLogin()}},{text:this.tr("button.removeMe","loginRecordDetail"),click:function(){e.deleteAccount(t,null,!1)}}]})},e.prototype.resetSwitchStatus=function(){this.switching=!1,this.$toast.hide()},e.prototype.logout=function(){this._showLogoutActionSheet()},o.__decorate([(0,c.Component)({template:n("/TmB"),data:function(){return{$trPage:"accountSwitch"}}})],e)}((0,c.Mixins)(s.default));e.default=d}}]);